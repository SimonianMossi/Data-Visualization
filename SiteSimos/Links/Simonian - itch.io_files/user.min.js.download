(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.UserHeader=function(superClass){extend(UserHeader,superClass);function UserHeader(){UserHeader.__super__.constructor.apply(this,arguments);this.el.dispatch("click",{edit_theme_btn:function(_this){return function(){return _this.toggle_theme_editor()}}(this)});if(window.location.hash.match(/\bedit_theme\b/)){_.defer(function(_this){return function(){return _this.toggle_theme_editor()}}(this))}}UserHeader.prototype.toggle_theme_editor=function(){var new_open;new_open=!I.theme_editor.state.open;I.theme_editor.setState({open:new_open});return $(document.body).toggleClass("theme_editor_open",new_open)};return UserHeader}(I.Header)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.UserPage=function(){UserPage.prototype.sticky_selector=".profile_column, .game_column";function UserPage(el,opts){this.opts=opts;this.el=$(el);this.setup_grid();this.setup_tracking();if(this.opts.ac){I.setup_affiliate_code(this.opts.ac)}}UserPage.prototype.setup_grid=function(){var lists;this.grid=new I.GameGrid(this.el.find(".user_game_grid"),{selector:".mode_grid .user_game_grid .game_cell .game_thumb",width_selector:".mode_grid .user_game_grid .game_cell",show_popups:false});lists=$(".purchased_games, .collections");lists.lazy_images({});return new I.GameCells(lists)};UserPage.prototype.setup_tracking=function(){I.setup_grid_referrers(this.el,function(_this){return function(){return"user:"+_this.opts.user_id}}(this));return I.tracked_links(this.el,"user")};return UserPage}();I.UserToolProfilePage=function(superClass){extend(UserToolProfilePage,superClass);function UserToolProfilePage(){UserToolProfilePage.__super__.constructor.apply(this,arguments);this.game_cells=this.grid.el.find(".game_cell");this.render_tool_tag_filter();this.render_grouped_games()}UserToolProfilePage.prototype.setup_grid=function(){return this.grid=new I.GameGrid(this.el.find(".user_game_grid"),{selector:".user_game_grid .game_cell .game_thumb",width_selector:".user_game_grid .game_cell",expected_size:280})};UserToolProfilePage.prototype.render_grouped_games=function(){var game,games,group,i,id,len,ref,results,seen_games;this.grid.el.empty();seen_games={};ref=this.opts.default_groups;results=[];for(i=0,len=ref.length;i<len;i++){group=ref[i];games=this.find_games_by_filter(group.filter);if(!games.length){continue}games=function(){var j,len1,results1;results1=[];for(j=0,len1=games.length;j<len1;j++){game=games[j];id=$(game).data("game_id");if(seen_games[id]){continue}seen_games[id]=true;results1.push(game)}return results1}();games=$(games);this.grid.el.append($("<h2></h2>").text(group.title));results.push(games.appendTo(this.grid.el))}return results};UserToolProfilePage.prototype.render_filtered_games=function(filter){this.grid.el.empty();return this.find_games_by_filter(filter).appendTo(this.grid.el)};UserToolProfilePage.prototype.find_games_by_filter=function(filter){var cell,found_count,key,out,tag_id,total_filters;total_filters=function(){var results;results=[];for(key in filter){if(!hasProp.call(filter,key))continue;results.push(key)}return results}().length;out=function(){var i,j,len,len1,ref,ref1,results;ref=this.game_cells;results=[];for(i=0,len=ref.length;i<len;i++){cell=ref[i];cell=$(cell);found_count=0;ref1=cell.data("tags")||[];for(j=0,len1=ref1.length;j<len1;j++){tag_id=ref1[j];if(filter[tag_id]){found_count+=1}}if(found_count===total_filters){results.push(cell[0])}else{continue}}return results}.call(this);return $(out)};UserToolProfilePage.prototype.render_tool_tag_filter=function(){var drop;drop=this.el.find(".tool_tags_filter_drop");return ReactDOM.render(R.User.ToolTags($.extend({on_select_tags:function(_this){return function(tags){if($.isEmptyObject(tags)){return _this.render_grouped_games()}else{return _this.render_filtered_games(tags)}}}(this)},this.opts.tool_tags_props)),drop[0])};return UserToolProfilePage}(I.UserPage)}).call(this);(function(){I.UserUserTools=function(){function UserUserTools(el){this.el=$(el);I.tracked_links(this.el,"view_user","user_tools");I.has_follow_button(this.el);setTimeout(function(_this){return function(){return _this.el.removeClass("hidden")}}(this),200)}return UserUserTools}();I.UserLayout=function(){function UserLayout(el){this.el=$(el);$(".user_page_wrap").max_height($(".header_widget").outerHeight(true)||0);new I.UserUserTools(this.el.find(".user_tools"))}return UserLayout}()}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("User");types=PropTypes;P("GameGrid",{render:function(){return this.enclose({className:["game_grid_widget","user_game_grid"],children:this.props.games.map(function(_this){return function(game){return _this.render_game(game)}}(this))})},render_game:function(game){var thumb_style;thumb_style={backgroundColor:game.bg_color,backgroundImage:game.cover_image_url&&"url("+game.cover_image_url+")"};return div({className:classNames("game_cell",{has_cover:game.cover_image_url}),key:game.url},a({href:game.url,className:"thumb_link","data-label":"game:"+game.id+":thumb","data-action":"game_grid"},div({className:"game_thumb",style:thumb_style})),div({className:"game_cell_data"},div({className:"game_title"},a({href:game.url,className:"title","data-label":"game:"+game.id+":title","data-action":"game-grid"},game.title))))}});P("ToolTags",{getInitialState:function(){return{selected_tags:$.extend({},this.props.default_tags)}},componentDidMount:function(){},tags_by_id:function(){if(this._tags_by_id){return this._tags_by_id}this._tags_by_id={};this.props.tag_groups.forEach(function(_this){return function(group){return group.tags.forEach(function(tag){tag.group=group;return _this._tags_by_id[""+tag.id]=tag})}}(this));return this._tags_by_id},select_tag:function(id){var base,i,len,other_tag,ref,selected_tags,tag;selected_tags=$.extend({},this.state.selected_tags);tag=this.tags_by_id()[id];ref=tag.group.tags;for(i=0,len=ref.length;i<len;i++){other_tag=ref[i];delete selected_tags[other_tag.id]}selected_tags[tag.id]=true;this.setState({selected_tags:selected_tags});return typeof(base=this.props).on_select_tags==="function"?base.on_select_tags(selected_tags):void 0},unselect_group:function(group){var base,i,len,ref,selected_tags,tag;selected_tags=$.extend({},this.state.selected_tags);ref=group.tags;for(i=0,len=ref.length;i<len;i++){tag=ref[i];delete selected_tags[tag.id]}this.setState({selected_tags:selected_tags});return typeof(base=this.props).on_select_tags==="function"?base.on_select_tags(selected_tags):void 0},render:function(){var dropdowns;dropdowns=this.props.tag_groups.map(function(_this){return function(group){var options,selected_tag;selected_tag=group.tags.find(function(t){if(_this.state.selected_tags[t.id]){return true}});options=group.tags.map(function(tag){return{name:tag.name,value:tag.id}});if(!options.length){return}options.unshift({name:"Any",value:""});return R.Forms.SimpleSelect({key:group.slug,name:group.slug,value:(selected_tag!=null?selected_tag.id:void 0)||"default",render_current_option:function(current){if(current.value===""){return group.name}else{return strong({},current.name)}},onChange:function(value){var tag;tag=_this.tags_by_id()[value];if(tag){return _this.select_tag(tag.id)}else{return _this.unselect_group(group)}},options:options})}}(this));return this.enclose({},label({},"Filter games"),dropdowns,!$.isEmptyObject(this.state.selected_tags)?div({className:"clear_area"},a({href:"#",onClick:function(_this){return function(e){var base;e.preventDefault();_this.setState({selected_tags:{}});return typeof(base=_this.props).on_select_tags==="function"?base.on_select_tags({}):void 0}}(this)},"Clear filters")):void 0)}})})}).call(this);
